---
title: 原型&原型链
---
javascript常被描述为一种基于原型的语言——每个对象拥有一个原型对象。当试图访问一个对象的属性时
---
# 原型&原型链

## 一、原型

javascript常被描述为一种基于原型的语言——每个对象拥有一个原型对象

当试图访问一个对象的属性时，它不仅仅在该对象上搜索，还会搜寻该对象的原型，以及该对象的原型的原型，依次层层向上搜索，直到找到一个名字匹配的属性或到达原型链末尾。

### 什么是原型？

在JavaScript中，每个函数（除了箭头函数）都有一种特殊的属性叫做prototype（显示原型）。这个属性是一个对象，我们称之为原型对象。

这个prototype对象的作用就是：当使用new关键字调用该函数作为构造函数时，新创建的实例对象会继承该原型对象上的属性和方法。 

**举个例子:构造函数和原型**

```javascript
// 1. 创建一个构造函数
function Person(name) {
    this.name = name
}

// 2. 为构造函数的prototype属性添加方法
Person.prototype.sayHello = function() {
    console.log(`你好，我是 ${this.name}`)
}

// 3. 使用new 创建实例
const person1 = new Person('Alice')
const person2 = new Person('Bob')

// 4. 实例可以访问原型上的方法
person1.sayHello() // =>: '你好，我是 Alice'
person2.sayHello() // =>: '你好，我是 Bob'
```

**关键点：**

- Person.prototype是构造函数Person的属性，它是一个对象
- person1和person2是实例对象，它们本身没有sayHello方法。
- 当调用person1.sayHello()时，JavaScript引擎发现Person1自身没有这个方法，于是它会去person1的原型上去查。

那么，实例对象如何知道自己的原型是哪个对象呢？这就引出了另一个属性：`__proto__`。

## 二、`__proto__`与原型链

### 什么是`__proto__`?

每个JavaScript对象（包括函数，因为函数也是对象）都有一个内置属性[[Prototype]]（在ES5标准中的称呼）。在大多数浏览器和Node环境中，我们可以通过`__proto__`这个非标准但被广泛实现的属性来访问它。

**重要关系：**

**实例对象的__proto__属性，指向其构造函数的prototype对象**

用上面的例子验证：

```javascript
console.log(person1.__proto__ === Person.prototype) // true
console.log(person2.__proto__ === Person.prototype) // true
```

这个关系可以用下图清晰地表示：

```javascript
（实例对象）person1
    │
    ├── 自身属性: name: 'Alice'
    └── __proto__ 属性 ---→ （原型对象）Person.prototype
                                │
                                ├── 方法: sayHello: function() {...}
                                └── constructor 属性 ---→ （构造函数）Person
```

### 什么是原型链？

现在，一个最重要的问题是：Person.prototype也是一个对象，那么它也有`__proto__`属性吗?

答案是肯定的。Person.prototype是一个普通对象,它是由Object这个内置构造函数创建的。所以：

```javascript
console.log(Person.prototype.__proto__ === Object.prototype) // true
```

而Object.prototype是原型链的顶端，它的`__proto__`是null。

```javascript
console.log(Obejct.prototype.__proto__) // null
```

当我们访问一个对象的属性或方法时（例如person1.toString()）,JavaScript引擎会执行以下搜索：

1. **检查自身属性：**首先在对象自身查找（比如person1.name是自身属性）。
2. **延原型链向上查找：**如果自身没有，就通过`__proto__`去它的原型上查找（Person.prototype）。
3. **继续向上：**如果原型上也没有，就通过原型的`__proto__`继续向上查找（Object.prototype）。
4. **直到终点：**一直查找到Object.prototype，如果还没有，再往上就是null，此时返回undefined。

这种通过`__proto__`属性连接起来的一系列对象，就构成了原型链。

**完整原型链图示：**

```
（实例对象）person1
    │
    ├── 自身属性: name: 'Alice'
    └── __proto__  ---→ （原型对象）Person.prototype
                            │
                            ├── 方法: sayHello
                            └── __proto__  ---→ （顶层原型）Object.prototype
                                                    │
                                                    ├── 方法: toString, hasOwnProperty, ...
                                                    └── __proto__  ---→ null
```

## 三、总结与核心要点

| 概念        | 描述                       | 归属                   | 目的                                       |
| :---------- | -------------------------- | ---------------------- | ------------------------------------------ |
| prototype   | 一个对象，是构造函数的属性 | 函数（构造函数）       | 让所有由该构造函数创建的实例共享方法和属性 |
| `__proto__` | 一个指向原型对象的指针     | 每个对象（包括函数）   | 构成原型链，实现继承和属性查找。           |
| 原型链      | 由`__proto__`组成的对象链  | 整个javascript对象系统 | 当访问属性对象时，提供一种向上查找的机制。 |

### 为什么需要原型和原型链？

1. **共享方法与节省内存：**将公共的方法定义在prototype上，所有实例可以共享同一个方法的引用，而不是每个实例都创建一份方法的副本，极大地节省了内存。

2. 实现继承：这是JavaScript中实现面向对象编程中继承的主要方式。我们可以让构造函数的prototype指向另一个构造函数的实例，从而继承其属性和方法。

   ```javascript
   function Student(name, grade) {
       Person.call(this, name)
       this.grade = grade
   }
   
   // 继承方法： 让Student 的原型指向Person 的实例
   Student.prototype = Object.create(Person.prototype)
   Student.prototype.constructor = Student // 修复constructor 指向
   
   const student1 = new Student('小明' ,'高一')
   student1.sayHello(); // 成功调用从Person 继承的方法
   ```

   **一个重要的内置关系**

   Function.prototype是一个特殊的对象，所有函数（包括Object，Array，Function自己）的`__proto__`都指向它。

   ```javascript
   console.log(Person.__proto__ === Function.prototype) // true
   console.log(Object.__proto__ === Function.prototype) // ture
   console.log(Function.__proto__ === Function.prototype) // true
   ```

原型是一个对象，用于让所有使用某个构造函数的实例对象共享原型上的方法和属性。

`__proto__`是一个指针，指向原型对象，用于原型链的构成，实现继承和查找功能。